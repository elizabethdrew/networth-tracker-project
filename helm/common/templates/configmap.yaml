{{- define "common.configmap" -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.app.configMapName }}
data:
  {{- if .Values.app.enabledFeatures.profile }}
  SPRING_PROFILES_ACTIVE: {{ .Values.app.activeProfile }}
  {{- end }}
  {{- if .Values.app.enabledFeatures.mysql }}
  SPRING_DATASOURCE_URL: jdbc:mysql://{{ .Values.app.serviceName }}-mysql:3306/{{ .Values.app.serviceName }}db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
  SPRING_DATASOURCE_USERNAME: {{ .Values.mysql.databaseUser }}
  SPRING_DATASOURCE_PASSWORD: {{ .Values.mysql.databasePassword }}
  MYSQL_ROOT_PASSWORD: root_{{ .Values.mysql.databasePassword }}
  MYSQL_DATABASE: {{ .Values.app.serviceName }}db
  MYSQL_USER: {{ .Values.mysql.databaseUser }}
  MYSQL_PASSWORD: {{ .Values.mysql.databasePassword }}
  {{- end }}
  {{- if .Values.app.enabledFeatures.config }}
  SPRING_CONFIG_IMPORT: {{ .Values.app.configServerURL }}
  SPRING_CLOUD_CONFIG_URI: {{ .Values.app.configURI }}
  {{- end }}
  {{- if .Values.app.enabledFeatures.discovery }}
  SPRING_CLOUD_KUBERNETES_DISCOVERY_DISCOVERY_SERVER_URL: {{ .Values.app.discoveryServerURL }}
  {{- end }}
  {{- end -}}